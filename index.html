<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOZDAMAS FIX</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        #lobby { padding: 50px; }
        .btn-principal { background: #fbbf24; color: black; padding: 20px; border: none; font-weight: bold; width: 80%; cursor: pointer; }
        
        /* O TABULEIRO - For√ßando visibilidade */
        #game-screen { display: none; padding: 10px; background: #e0e0e0; min-height: 100vh; }
        #board { 
            display: grid; 
            grid-template-columns: repeat(8, 45px); 
            grid-template-rows: repeat(8, 45px); 
            gap: 0; 
            border: 5px solid #333; 
            margin: 20px auto;
            width: 360px;
            height: 360px;
        }
        .sq { width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; }
        .dark { background: #769656 !important; } 
        .light { background: #eeeed2 !important; }
        .piece { width: 35px; height: 35px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.2); }
        .w { background: white; }
        .r { background: #e53935; }
        #controles { color: black; font-weight: bold; }
    </style>
</head>
<body>

    <div id="lobby">
        <h1>MOZDAMAS</h1>
        <button class="btn-principal" onclick="iniciarNovoJogo()">CLIQUE AQUI PARA CRIAR MESA</button>
        <div id="status"></div>
    </div>

    <div id="game-screen">
        <button onclick="location.reload()" style="float: left;">SAIR</button>
        <div id="board"></div>
        <div id="controles">
            <p>MESA ATIVA</p>
            <button onclick="sentar('p1')">SENTAR LUGAR #1</button>
            <button onclick="sentar('p2')">SENTAR LUGAR #2</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDNbEcUFGagPPKrEfM5ZmH-RMgNtAp5Rmo",
        databaseURL: "https://mozdamasonline-default-rtdb.firebaseio.com",
        projectId: "mozdamasonline",
        appId: "1:832141619024:web:1d46fcef9e2e37c0274655"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let salaID = "mesa_teste_1";
    let meuID = "User_" + Math.floor(Math.random()*999);

    function iniciarNovoJogo() {
        // Criar tabuleiro inicial
        let b = Array(64).fill(null);
        for(let i=0; i<64; i++) {
            let r=Math.floor(i/8), c=i%8;
            if((r+c)%2==0) {
                if(r<3) b[i] = 'r';
                if(r>4) b[i] = 'w';
            }
        }
        // Gravar no Firebase e entrar
        db.ref('rooms/' + salaID).set({ board: b, p1: null, p2: null }).then(() => {
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            escutarJogo();
        });
    }

    function escutarJogo() {
        db.ref('rooms/' + salaID).on('value', snap => {
            const dados = snap.val();
            const bDiv = document.getElementById('board');
            bDiv.innerHTML = "";
            
            dados.board.forEach((p, i) => {
                const r = Math.floor(i/8), c = i%8;
                const sq = document.createElement('div');
                sq.className = `sq ${(r+c)%2==0 ? 'dark' : 'light'}`;
                if(p) {
                    const pc = document.createElement('div');
                    pc.className = `piece ${p}`;
                    sq.appendChild(pc);
                }
                bDiv.appendChild(sq);
            });
        });
    }

    function sentar(p) {
        db.ref('rooms/'+salaID+'/'+p).set(meuID);
        alert("Sentou no lugar " + p);
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MOZDAMAS REGRAS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 10px; }
        #board { display: grid; grid-template-columns: repeat(8, 11vw); grid-template-rows: repeat(8, 11vw); border: 4px solid #334155; margin: 15px auto; width: fit-content; }
        @media (min-width: 500px) { #board { grid-template-columns: repeat(8, 50px); grid-template-rows: repeat(8, 50px); } }
        .sq { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .dark { background: #769656; } .light { background: #eeeed2; }
        .piece { width: 80%; height: 80%; border-radius: 50%; border: 2px solid rgba(0,0,0,0.2); }
        .white { background: #fff; box-shadow: 0 3px 0 #ccc; }
        .black { background: #1a1a1a; box-shadow: 0 3px 0 #000; }
        .sel { background: rgba(251, 191, 36, 0.5) !important; }
        input { padding: 12px; border-radius: 5px; width: 60%; border: none; }
        button { background: #fbbf24; padding: 12px; border: none; font-weight: bold; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="lobby">
        <input type="text" id="room" placeholder="Sala">
        <button onclick="entrar()">ENTRAR</button>
    </div>
    <div id="board"></div>
    <h3 id="msg">Seleciona uma peça</h3>

<script>
    const cfg = {
        apiKey: "AIzaSyDNbEcUFGagPPKrEfM5ZmH-RMgNtAp5Rmo",
        databaseURL: "https://mozdamasonline-default-rtdb.firebaseio.com",
        projectId: "mozdamasonline",
        appId: "1:832141619024:web:1d46fcef9e2e37c0274655"
    };
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    const db = firebase.database();
    
    let b = Array(64).fill(null);
    let s = null; 
    let rId = '';

    function render() {
        const div = document.getElementById('board');
        div.innerHTML = '';
        b.forEach((p, i) => {
            const row = Math.floor(i/8), col = i%8;
            const sq = document.createElement('div');
            sq.className = `sq ${(row+col)%2==0?'dark':'light'} ${s===i?'sel':''}`;
            if(p) {
                const pc = document.createElement('div');
                pc.className = `piece ${p === 'w' ? 'white' : 'black'}`;
                sq.appendChild(pc);
            }
            sq.onclick = () => clique(i);
            div.appendChild(sq);
        });
    }

    function clique(i) {
        const row = Math.floor(i/8), col = i%8;
        if (b[i]) {
            s = i; // Seleciona
        } else if (s !== null) {
            const sRow = Math.floor(s/8), sCol = s%8;
            const rowDiff = row - sRow;
            const colDiff = Math.abs(col - sCol);

            // REGRA: Movimento Simples (1 casa diagonal)
            if (Math.abs(rowDiff) === 1 && colDiff === 1) {
                mover(s, i);
            } 
            // REGRA: Captura (2 casas diagonal)
            else if (Math.abs(rowDiff) === 2 && colDiff === 2) {
                const mRow = (sRow + row) / 2;
                const mCol = (sCol + col) / 2;
                const mIdx = mRow * 8 + mCol;
                if (b[mIdx] && b[mIdx] !== b[s]) {
                    b[mIdx] = null; // Remove a peça capturada
                    mover(s, i);
                }
            }
        }
        render();
    }

    function mover(de, para) {
        b[para] = b[de];
        b[de] = null;
        s = null;
        if(rId) db.ref('rooms/' + rId).set(b);
    }

    function entrar() {
        rId = document.getElementById('room').value.toLowerCase().trim();
        if(!rId) return;
        db.ref('rooms/' + rId).on('value', snap => {
            if (snap.exists()) b = snap.val();
            else { resetBoard(); db.ref('rooms/' + rId).set(b); }
            render();
        });
    }

    function resetBoard() {
        b.fill(null);
        for(let i=0; i<64; i++) {
            let r = Math.floor(i/8), c = i%8;
            if((r+c)%2==0) {
                if(r < 3) b[i] = 'b';
                if(r > 4) b[i] = 'w';
            }
        }
    }
    resetBoard();
    render();
</script>
</body>
</html>

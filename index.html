<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Damas Pro Master - Online</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --board-dark: #769656;
            --board-light: #eeeed2;
            --white-p: radial-gradient(circle, #ffffff 30%, #cccccc 100%);
            --black-p: radial-gradient(circle, #444444 30%, #000000 100%);
            --accent: #2ecc71;
            --danger: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #top-bar { background: #111; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; height: 50px; border-bottom: 1px solid #333; }
        .dot { width: 8px; height: 8px; background: var(--danger); border-radius: 50%; display: inline-block; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        #game-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px 15px; background: #222; height: 110px; }
        .hud-top { display: flex; justify-content: space-between; font-size: 10px; color: #888; font-weight: bold; }
        #board-wrapper { flex: 1; display: flex; align-items: center; justify-content: center; padding: 10px; position: relative; }
        #board { width: min(90vw, 450px); height: min(90vw, 450px); display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); border: 4px solid #333; }
        #lobby-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .square { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .dark-sq { background-color: var(--board-dark); }
        .light-sq { background-color: var(--board-light); }
        .piece { width: 80%; height: 80%; border-radius: 50%; z-index: 2; box-shadow: 0 4px 4px rgba(0,0,0,0.4); position: relative; }
        .white { background: var(--white-p); border: 1px solid #999; }
        .black { background: var(--black-p); border: 1px solid #333; }
        .king::after { content: 'ðŸ‘‘'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; }
        .selected { transform: scale(1.1); outline: 4px solid #f1c40f; z-index: 10; }
        .timer { font-family: monospace; font-size: 1.6rem; background: #000; padding: 5px; text-align: center; border-radius: 4px; color: #444; border: 2px solid #333; }
        .timer.active { color: var(--accent); border-color: var(--accent); }
        #status-bar { grid-column: span 2; text-align: center; color: #f1c40f; font-weight: bold; font-size: 0.9rem; }
        .btn-start { padding: 15px 30px; background: var(--accent); border: none; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 1.1rem; }
    </style>
</head>
<body>
    <div id="top-bar">
        <div style="font-weight: bold; color: var(--accent);">ðŸ‘‘ DAMAS PRO ONLINE</div>
        <div class="viewer-count"><span class="dot"></span> AO VIVO</div>
    </div>
    <div id="game-info">
        <div><div class="hud-top"><span>PRETAS</span></div><div id="timer-black" class="timer">05:00</div></div>
        <div><div class="hud-top"><span>BRANCAS</span></div><div id="timer-white" class="timer">05:00</div></div>
        <div id="status-bar">CONECTANDO...</div>
    </div>
    <div id="board-wrapper">
        <div id="lobby-overlay" style="display:none"><button class="btn-start" onclick="iniciarPartida()">REINICIAR JOGO</button></div>
        <div id="board"></div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Credenciais do seu print
    const firebaseConfig = {
        apiKey: "AIzaSyCYv_obSjs7x7hLx8p1IANOWMI5G6OmpGo",
        authDomain: "damas-pro-cf92b.firebaseapp.com",
        databaseURL: "https://damas-pro-cf92b-default-rtdb.firebaseio.com",
        projectId: "damas-pro-cf92b",
        storageBucket: "damas-pro-cf92b.firebasestorage.app",
        appId: "1:606989896803:web:63c2b940baf9f82fcf7c56"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, 'partida_v2');

    let board = []; let turn = 'white'; let selectedSq = null;

    function renderBoard() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                const sq = document.createElement('div');
                sq.className = `square ${(r+c)%2===0?'dark-sq':'light-sq'}`;
                sq.onclick = () => handleClick(r, c);
                if (board[r] && board[r][c]) {
                    const p = board[r][c];
                    const pDiv = document.createElement('div');
                    pDiv.className = `piece ${p.color} ${p.king ? 'king' : ''} ${selectedSq?.r === r && selectedSq?.c === c ? 'selected' : ''}`;
                    sq.appendChild(pDiv);
                }
                boardEl.appendChild(sq);
            }
        }
        document.getElementById('status-bar').innerText = turn === 'white' ? "VEZ DAS BRANCAS" : "VEZ DAS PRETAS";
        document.getElementById('timer-white').classList.toggle('active', turn === 'white');
        document.getElementById('timer-black').classList.toggle('active', turn === 'black');
    }

    onValue(gameRef, (snap) => {
        const data = snap.val();
        if (data) {
            board = data.board; turn = data.turn;
            document.getElementById('lobby-overlay').style.display = 'none';
            renderBoard();
        } else {
            document.getElementById('lobby-overlay').style.display = 'flex';
            document.getElementById('status-bar').innerText = "SALA AGUARDANDO...";
        }
    });

    window.iniciarPartida = () => {
        let nb = Array(8).fill().map(() => Array(8).fill(null));
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                if((r+c)%2===0) {
                    if(r<3) nb[r][c] = {color:'black', king:false};
                    else if(r>4) nb[r][c] = {color:'white', king:false};
                }
            }
        }
        set(gameRef, { board: nb, turn: 'white' });
    };

    function handleClick(r, c) {
        const p = board[r][c];
        if (p && p.color === turn) {
            selectedSq = {r, c}; renderBoard();
        } else if (selectedSq && !p) {
            // MovimentaÃ§Ã£o bÃ¡sica sincronizada
            board[r][c] = board[selectedSq.r][selectedSq.c];
            board[selectedSq.r][selectedSq.c] = null;
            if ((turn === 'white' && r === 0) || (turn === 'black' && r === 7)) board[r][c].king = true;
            const nextTurn = turn === 'white' ? 'black' : 'white';
            update(gameRef, { board: board, turn: nextTurn });
            selectedSq = null;
        }
    }
</script>
</body>
</html>

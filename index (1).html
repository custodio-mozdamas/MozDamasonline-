<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOZDAMAS ONLINE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0f172a; --board-dark: #769656; --board-light: #eeeed2; --piece-op: #1a1a1a; --accent: #fbbf24; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 10px; }
        #lobby { background: #1e293b; padding: 25px; border-radius: 15px; text-align: center; margin-top: 40px; box-shadow: 0 10px 30px #000; width: 90%; max-width: 400px; }
        input { padding: 12px; border-radius: 8px; border: 2px solid #334155; width: 80%; margin: 10px; font-size: 1rem; background: #0f172a; color: white; }
        button { background: var(--accent); color: #000; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 85%; }
        .game-ui { display: none; flex-direction: column; align-items: center; width: 100%; }
        .menu-bar { background: #1e293b; padding: 10px; border-radius: 10px; display: flex; gap: 10px; margin-bottom: 10px; font-size: 0.75rem; flex-wrap: wrap; justify-content: center; }
        #board { display: grid; grid-template-columns: repeat(8, 11.5vw); grid-template-rows: repeat(8, 11.5vw); border: 6px solid #334155; max-width: 480px; max-height: 480px; }
        @media (min-width: 600px) { #board { grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); } }
        .sq { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .dark { background: var(--board-dark); }
        .light { background: var(--board-light); }
        .piece { width: 85%; height: 85%; border-radius: 50%; cursor: pointer; position: relative; }
        .white { background: radial-gradient(circle at 30% 30%, #fff, #94a3b8); border: 1px solid #64748b; }
        .black { background: radial-gradient(circle at 30% 30%, var(--piece-op), #000); border: 1px solid #000; }
        .king::after { content: '★'; color: gold; font-size: 20px; display: flex; justify-content: center; align-items: center; height: 100%; }
        .sel { outline: 4px solid var(--accent); z-index: 5; }
        .status { margin: 10px; color: var(--accent); font-weight: bold; text-transform: uppercase; font-size: 0.8rem; }
        /* Temas */
        .theme-verde { --board-dark: #769656; --board-light: #eeeed2; --piece-op: #1a1a1a; }
        .theme-cinza { --board-dark: #708090; --board-light: #d3d3d3; --piece-op: #0000ff; }
        .theme-preto { --board-dark: #2a2a2a; --board-light: #555555; --piece-op: #ff0000; }
        .theme-castanho { --board-dark: #8b4513; --board-light: #deb887; --piece-op: #3d1f0a; }
    </style>
</head>
<body class="theme-verde" id="main-body">

    <div id="lobby">
        <h1 style="color:var(--accent); margin:0 0 10px 0;">MOZDAMAS</h1>
        <p style="font-size:0.9rem">Crie ou entre numa sala para jogar online:</p>
        <input type="text" id="room-input" placeholder="Nome da Sala (ex: moz1)">
        <br>
        <button onclick="startOnline()">ENTRAR NA SALA</button>
    </div>

    <div class="game-ui" id="game-ui">
        <div class="menu-bar">
            <select onchange="document.getElementById('main-body').className = this.value">
                <option value="theme-verde">Verde (Normal)</option>
                <option value="theme-cinza">Cinza (Azul)</option>
                <option value="theme-preto">Preto (Vermelho)</option>
                <option value="theme-castanho">Castanho</option>
            </select>
            <div style="padding:5px">SALA: <span id="room-name" style="color:var(--accent)">-</span></div>
            <div style="padding:5px">COR: <span id="my-color" style="color:var(--accent)">-</span></div>
        </div>
        <div id="board"></div>
        <div id="msg" class="status">Aguardando...</div>
    </div>

<script>
    // Configuração do Firebase integrada com as tuas chaves
    const firebaseConfig = {
      apiKey: "AIzaSyDNbEcUFGagPPKrEfM5ZmH-RMgNtAp5Rmo",
      authDomain: "mozdamasonline.firebaseapp.com",
      databaseURL: "https://mozdamasonline-default-rtdb.firebaseio.com",
      projectId: "mozdamasonline",
      storageBucket: "mozdamasonline.firebasestorage.app",
      messagingSenderId: "832141619024",
      appId: "1:832141619024:web:1d46fcef9e2e37c0274655"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let board = Array(64).fill(null);
    let turn = 'w', sel = null, myRole = '', roomID = '';

    function startOnline() {
        roomID = document.getElementById('room-input').value.trim().toLowerCase();
        if(!roomID) return alert("Insira o nome da sala!");
        
        const ref = db.ref('rooms/' + roomID);
        ref.once('value', snap => {
            if(!snap.exists()) {
                myRole = 'w'; // Criador é Brancas
                resetBoard();
                save();
            } else {
                myRole = 'b'; // Oponente é Pretas
            }
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            document.getElementById('room-name').innerText = roomID;
            document.getElementById('my-color').innerText = myRole === 'w' ? 'BRANCAS' : 'OPONENTE';
            
            ref.on('value', s => {
                const d = s.val();
                if(d) { board = d.board; turn = d.turn; render(); checkWin(); }
            });
        });
    }

    function resetBoard() {
        board.fill(null);
        for(let r=0; r<8; r++) for(let c=0; c<8; c++) {
            if((r+c)%2 === 0) {
                if(r<3) board[r*8+c] = {color:'b', king:false};
                if(r>4) board[r*8+c] = {color:'w', king:false};
            }
        }
    }

    function render() {
        const bDiv = document.getElementById('board'); bDiv.innerHTML = '';
        board.forEach((p, i) => {
            const sq = document.createElement('div');
            const r = Math.floor(i/8), c = i%8;
            sq.className = `sq ${(r+c)%2===0?'dark':'light'}`;
            if(p) {
                const pDiv = document.createElement('div');
                pDiv.className = `piece ${p.color==='w'?'white':'black'} ${p.king?'king':''} ${sel===i?'sel':''}`;
                pDiv.onclick = (e) => { e.stopPropagation(); if(turn === myRole) sel = i; render(); };
                sq.appendChild(pDiv);
            }
            sq.onclick = () => { if(turn === myRole && sel !== null) movePiece(i); };
            bDiv.appendChild(sq);
        });
        document.getElementById('msg').innerText = turn === myRole ? "Teu Turno" : "Aguardando Oponente...";
    }

    function movePiece(to) {
        if(board[to] || (Math.floor(to/8) + to%8)%2 !== 0) return;
        const p = board[sel];
        const dist = Math.abs(sel - to);
        
        // Movimento Simples
        if(dist === 7 || dist === 9) {
            board[to] = p; board[sel] = null;
        } 
        // Captura
        else if(dist === 14 || dist === 18) {
            const mid = (sel + to) / 2;
            if(board[mid] && board[mid].color !== p.color) {
                board[mid] = null;
                board[to] = p; board[sel] = null;
            } else return;
        } else return;

        if((p.color==='w' && to<8)||(p.color==='b' && to>55)) p.king = true;
        turn = turn === 'w' ? 'b' : 'w';
        sel = null;
        save();
    }

    function save() { db.ref('rooms/' + roomID).set({board, turn}); }

    function checkWin() {
        const w = board.filter(x => x?.color === 'w').length;
        const b = board.filter(x => x?.color === 'b').length;
        if(w === 0 || b === 0) {
            alert(w === 0 ? "As Pretas Venceram!" : "As Brancas Venceram!");
            if(myRole === 'w') { resetBoard(); turn = 'w'; save(); }
        }
    }
</script>
</body>
</html>
